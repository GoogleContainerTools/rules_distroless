<!-- Generated with Stardoc: http://skydoc.bazel.build -->

apt-get

<a id="deb_index"></a>

## deb_index

<pre>
deb_index(<a href="#deb_index-name">name</a>, <a href="#deb_index-manifest">manifest</a>, <a href="#deb_index-lock">lock</a>, <a href="#deb_index-package_template">package_template</a>, <a href="#deb_index-resolve_transitive">resolve_transitive</a>)
</pre>

A convience repository macro for apt rules.

This documentation provides an overview of the convenience repository macro around `package_index` and `resolve` repository rules.

### WORKSPACE Example

```starlark
load("@rules_distroless//apt:index.bzl", "deb_index")

deb_index(
    name = "bullseye",
    # For the initial setup, the lockfile attribute can be omitted and generated by running
    #    bazel run @bullseye//:lock
    # This will generate the lock.json file next to the manifest file by replacing `.yaml` with `.lock.json`
    lock = "//examples/apt:bullseye.lock.json",
    manifest = "//examples/apt:bullseye.yaml",
)

load("@bullseye//:packages.bzl", "bullseye_packages")
bullseye_packages()
```

### BZLMOD Example

```starlark
# TODO: support BZLMOD
```

### Macro Expansion

This macro will expand to two repositories: `#name` and `#name#_resolve`.

### Typical Workflow

A typical workflow for `deb_index` involves the generation of a lockfile (`deb_resolve`) and the consumption of the lockfile by `deb_package_index` for generating a DAG.

#### Lockfile Generation

The lockfile generation can be on-demand by omitting the `lock` attribute. However, this comes with the cost of performing a new package resolution on repository cache misses.

While we strongly encourage users to check in the generated lockfile, it's not always possible because Debian repositories are rolling by default. Therefore, a lockfile generated today might not work later if the upstream repository removes or publishes a new version of a package.

#### Snapshot repositories

##### Debian
Users can still use a `snapshot` repository and check in the generated lockfiles. This is possible because `snapshot.debian.org` is an immutable point-in-time snapshot of the upstream repositories, meaning packages never get deleted or updated in a specific snapshot.

An example of this can be found at [/examples/debian_snapshot](/examples/debian_snapshot).

##### Ubuntu
Ubuntu also has a similar point-in-time snapshot service hosted at `snapshot.ubuntu.com`, which can be used similarly.

An example of this can be found at [/examples/ubuntu_snapshot](/examples/ubuntu_snapshot).


**PARAMETERS**


| Name  | Description | Default Value |
| :------------- | :------------- | :------------- |
| <a id="deb_index-name"></a>name |  name of the repository   |  none |
| <a id="deb_index-manifest"></a>manifest |  label to a <code>manifest.yaml</code>   |  none |
| <a id="deb_index-lock"></a>lock |  label to a <code>lock.json</code>   |  <code>None</code> |
| <a id="deb_index-package_template"></a>package_template |  (EXPERIMENTAL!) a template string for generated BUILD files. Available template replacement keys are: <code>{target_name}</code>, <code>{deps}</code>, <code>{urls}</code>, <code>{name}</code>, <code>{arch}</code>, <code>{sha256}</code>, <code>{repo_name}</code>   |  <code>None</code> |
| <a id="deb_index-resolve_transitive"></a>resolve_transitive |  whether dependencies of dependencies should be resolved and added to the lockfile.   |  <code>True</code> |


